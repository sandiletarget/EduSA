{% extends "core/base_student.html" %}
{% load static %}

{% block extra_head %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'core/css/calculator.css' %}">
{% endblock %}

{% block dashboard_content %}
<section class="dashboard-hero">
  <div>
    <p class="dashboard-hero__eyebrow">Welcome back</p>
    <h1 class="dashboard-hero__title">Hello, {{ request.user.first_name|default:request.user.username }}!</h1>
    <p class="dashboard-hero__subtitle">Continue your learning journey today.</p>
  </div>
  <div class="dashboard-hero__actions">
    <a class="btn btn-primary" href="{% url 'student_lessons' %}">Start Learning</a>
    <a class="btn btn-outline" href="{% url 'classes:join_class' %}">Join Class</a>
  </div>
</section>

<section class="stat-grid">
  <div class="stat-card">
    <p class="stat-card__label">My Classes</p>
    <p class="stat-card__value">{{ classrooms|length }}</p>
  </div>
  <div class="stat-card">
    <p class="stat-card__label">Upcoming Exams</p>
    <p class="stat-card__value">{{ exams|length }}</p>
  </div>
  <div class="stat-card">
    <p class="stat-card__label">Total Lessons</p>
    <p class="stat-card__value">{{ lessons|length }}</p>
  </div>
</section>

<section class="content-grid">
  <div class="panel">
    <div class="panel__header">
      <h2>My Classes</h2>
      <a href="{% url 'classes:join_class' %}">Join class</a>
    </div>
    <div class="panel__body">
      {% for classroom in classrooms %}
        <div class="panel-item">
          <div>
            <h3>{{ classroom.name }}</h3>
            <p>{{ classroom.description|default:"No description" }}</p>
          </div>
        </div>
      {% empty %}
        <p class="panel-empty">You have not joined any classes yet.</p>
      {% endfor %}
    </div>
  </div>

  <div class="panel">
    <div class="panel__header">
      <h2>Upcoming Exams</h2>
      <span class="muted">{{ exams|length }} total</span>
    </div>
    <div class="panel__body">
      {% for exam in exams|slice:":4" %}
        <div class="panel-item">
          <div>
            <h3>{{ exam.title }}</h3>
            <p>{{ exam.classroom.name }}</p>
          </div>
          {% if exam.due_date %}
            <span class="chip">Due {{ exam.due_date }}</span>
          {% endif %}
        </div>
      {% empty %}
        <p class="panel-empty">No exams available yet.</p>
      {% endfor %}
    </div>
  </div>

  <div class="panel">
    <div class="panel__header">
      <h2>Calculator & Formulas</h2>
      <button class="link-button" type="button" data-calculator-open>Open</button>
    </div>
    <div class="panel__body">
      <p class="panel-empty">Quick access to subject formulas and a scientific calculator.</p>
    </div>
  </div>
</section>

<section class="panel">
  <div class="panel__header">
    <h2>Recent Lessons</h2>
    <a href="{% url 'student_lessons' %}">View all</a>
  </div>
  <div class="panel__body">
    {% for lesson in lessons|slice:":4" %}
      <div class="panel-item">
        <div>
          <h3>{{ lesson.title }}</h3>
          <p>{{ lesson.description|default:"No description" }}</p>
        </div>
      </div>
    {% empty %}
      <p class="panel-empty">No lessons available.</p>
    {% endfor %}
  </div>
</section>

<div class="calculator-modal" data-calculator-modal hidden>
  <div class="calculator-modal__backdrop" data-calculator-close></div>
  <div class="calculator-modal__content" role="dialog" aria-modal="true" aria-label="Scientific calculator and formula library">
    <header class="calculator-modal__header">
      <h2>Scientific Calculator</h2>
      <button class="icon-btn" type="button" data-calculator-close aria-label="Close calculator">Ã—</button>
    </header>
    <div class="calculator-modal__body">
      {% include "core/components/classroom_calculator.html" with calc_id="calculator-main" formula_grade=learner_grade formula_subject="mathematics" grades=grades read_only=True %}
    </div>
  </div>
</div>

<script src="{% static 'core/js/calculator.js' %}"></script>
<script src="{% static 'core/js/formulas.js' %}"></script>
<script src="{% static 'core/js/calculator_modal.js' %}"></script>
{% endblock %}