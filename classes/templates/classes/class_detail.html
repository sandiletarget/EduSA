{% extends "core/base.html" %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'core/css/classroom.css' %}">
{% endblock %}

{% block body_class %}classroom-body app-gradient{% endblock %}

{% block content %}
<div class="classroom-page">
    {% include "core/components/grade_nav.html" %}
    <header class="classroom-hero">
        <div>
            <span class="classroom-kicker">Classroom</span>
            <h1 class="classroom-title">{{ classroom.name }}</h1>
            <p class="classroom-subtitle">{{ classroom.description|default:"No description yet." }}</p>
        </div>
        {% if active_session %}
            <span class="status-pill is-live">Live now</span>
        {% else %}
            <span class="status-pill">Offline</span>
        {% endif %}
    </header>

    <section class="classroom-grid">
        <div class="info-card">
            <p class="label">Teacher</p>
            <p class="value">{{ classroom.teacher.get_full_name|default:classroom.teacher.username }}</p>
        </div>
        {% if is_teacher %}
            <div class="info-card">
                <p class="label">Passcode</p>
                <p class="value">{{ classroom.passcode }}</p>
            </div>
        {% endif %}
        <div class="info-card">
            <p class="label">Members</p>
            <p class="value">{{ classroom.memberships.count }}</p>
        </div>
        <div class="info-card">
            <p class="label">Status</p>
            <p class="value">{% if active_session %}Live{% else %}Offline{% endif %}</p>
        </div>
    </section>

    <section class="classroom-actions">
        {% if is_teacher %}
            <a href="{% url 'lesson_add' %}" class="btn btn-primary">Create Lesson</a>
            <a href="{% url 'classes:start_live_session' classroom.pk %}" class="btn btn-outline">Start Live Session</a>
            <a href="{% url 'classes:assessment_list' classroom.pk %}" class="btn btn-outline">Assessments</a>
        {% else %}
            <a href="{% url 'student_lessons' %}" class="btn btn-primary">View Lessons</a>
            <a href="{% url 'classes:join_live_session' classroom.pk %}" class="btn btn-outline">Join Live Session</a>
            <a href="{% url 'classes:assessment_list' classroom.pk %}" class="btn btn-outline">Assessments</a>
        {% endif %}
    </section>

    <div class="classroom-alert">
        {% if active_session %}
            Live session active since {{ active_session.started_at|date:"F j, Y g:i a" }}
        {% else %}
            No live session running currently.
        {% endif %}
    </div>

    <section class="classroom-panel">
        <div class="panel-header">
            <div>
                <p class="panel-kicker">Live Session</p>
                <h2>Class Live Room</h2>
            </div>
            {% if active_session %}
                <span class="status-pill is-live">Live</span>
            {% else %}
                <span class="status-pill">Offline</span>
            {% endif %}
        </div>

        {% if active_session %}
            <div class="panel-media">
                <div class="panel-note">Live session is active. Join the built-in classroom to continue.</div>
                <a class="btn btn-primary" href="{% url 'classes:live_class_room' classroom.pk %}">Open Live Classroom</a>
            </div>
        {% else %}
            <p class="panel-note">The teacher has not started the live session yet.</p>
        {% endif %}
    </section>

    <section class="classroom-panel">
        <div class="panel-header">
            <div>
                <p class="panel-kicker">Members</p>
                <h2>Enrolled Learners</h2>
            </div>
            <span class="status-pill">{{ classroom.memberships.count }} total</span>
        </div>
        <ul class="member-list">
            {% for membership in memberships %}
                <li>{{ membership.learner.get_full_name|default:membership.learner.username }}</li>
            {% empty %}
                <li class="is-empty">No learners have joined yet.</li>
            {% endfor %}
        </ul>
    </section>
</div>
{% endblock %}
